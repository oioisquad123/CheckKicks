# PRD: AI-Powered Sneaker Authenticator (Auntentic)

## Introduction/Overview

**Auntentic** is an iOS app that uses AI to authenticate sneakers instantly. Users photograph their sneakers from multiple angles, and the app returns a confidence score indicating authenticity likelihood.

### Problem Statement
Counterfeit sneakers plague the secondary market. Existing services (CheckCheck, Legit Check by Ch) rely on human experts, charging ~$6/check with wait times of minutes to hours. Buyers and resellers need a faster, more affordable solution.

### Solution
A fully automated, AI-powered authentication app that delivers results in seconds with a subscription model (~$9.99/month unlimited). Clear disclaimers communicate that results are probabilistic, not guaranteed.

### Target Market
- U.S. sneaker collectors, resellers, and casual buyers
- iOS users (iPhone with camera)
- Popular brands: Nike, Jordan, Adidas Yeezy, New Balance, etc.

---

## Goals

| Goal | Success Metric | Priority |
|------|----------------|----------|
| Instant authentication | Result in < 30 seconds | P0 |
| High accuracy | ≥ 90% correct on test dataset | P0 |
| Simple UX | Complete check in < 2 minutes | P0 |
| Subscription revenue | 500+ subscribers in 6 months | P1 |
| User trust | 4.5+ App Store rating | P1 |

---

## Tech Stack (CRITICAL - Must Follow)

### Overview Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                        iOS App                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │   Views     │  │ ViewModels  │  │     Services        │ │
│  │  (SwiftUI)  │◄─┤   (MVVM)    │◄─┤ (Auth, API, Store)  │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      Supabase                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │    Auth     │  │   Storage   │  │   Edge Functions    │ │
│  │  (Users)    │  │  (Images)   │  │ (OpenAI Proxy)      │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
│                                              │              │
│  ┌─────────────┐                             ▼              │
│  │  Database   │◄────────────────   OpenAI Vision API      │
│  │ (History)   │                    (GPT-4o)                │
│  └─────────────┘                                            │
└─────────────────────────────────────────────────────────────┘
```

### Required Technologies

| Layer | Technology | Notes |
|-------|------------|-------|
| UI | SwiftUI (iOS 17+) | Pure SwiftUI, no UIKit unless necessary |
| Architecture | MVVM + async/await | Use @Observable for iOS 17+ |
| Auth | **Supabase Auth** | Apple Sign-In + Email/Password |
| Backend | **Supabase Edge Functions (Deno)** | Proxies to OpenAI |
| AI | **OpenAI GPT-4o Vision API** | Cloud-only, NO on-device ML |
| Image Storage | **Supabase Storage** | User-specific buckets with RLS |
| Database | **Supabase PostgreSQL** | For history, subscriptions, free checks |
| Payments | **StoreKit 2** | Native Apple IAP |
| Logging | os.Logger | Apple native logging |
| Networking | Supabase Swift SDK | Official SDK for all Supabase operations |

### CRITICAL: What NOT to Use

| Excluded | Reason |
|----------|--------|
| Core ML / On-device ML | Cloud AI only for easy updates |
| SwiftData for main data | Use Supabase PostgreSQL |
| Third-party auth libraries | Use Supabase Auth |
| Third-party networking (Alamofire) | Use URLSession + Supabase SDK |

---

## User Stories

### Core User Stories (MVP - Phase 1)

1. **As a buyer**, I want to photograph a sneaker and get an instant authenticity assessment so I can decide whether to purchase.

2. **As a user**, I want clear guidance on which 4 photos to take (outer side, inner side, size tag, box label) so the AI has enough information.

3. **As a user**, I want to see a confidence percentage with a clear verdict (Likely Authentic / Likely Fake / Inconclusive) so I understand the result.

4. **As a user**, I want to see a disclaimer that the result is AI-assisted and not guaranteed so I understand the limitations.

5. **As a subscriber**, I want unlimited authentication checks for a monthly fee ($9.99/month) so I can verify multiple sneakers affordably.

6. **As a new user**, I want to sign in with Apple or email via Supabase Auth so I can access my subscription across devices.

7. **As a non-subscriber**, I want 1 free check to try the app before subscribing.

### Extended User Stories (Phase 2+)

8. **As a returning user**, I want to view my authentication history stored in Supabase so I can reference past checks.

9. **As a user**, I want push notifications when my result is ready (if processing takes longer than expected).

10. **As a first-time user**, I want an onboarding tutorial explaining how the app works.

---

## Functional Requirements

### Phase 1: MVP (Weeks 1-4)

#### 1. Project Setup & Supabase Configuration
| ID | Requirement | Notes |
|----|-------------|-------|
| FR-0.1 | Create Xcode project targeting iOS 17.0+ with SwiftUI | Standard iOS project |
| FR-0.2 | Set up Supabase project with Auth, Storage, Database, Edge Functions | Backend infrastructure |
| FR-0.3 | Configure Supabase Swift SDK in the iOS app | Add via SPM |
| FR-0.4 | Create Supabase database schema (authentications, subscriptions, free_checks tables) | PostgreSQL |
| FR-0.5 | Set up Supabase Storage bucket for user images with RLS policies | Secure image storage |
| FR-0.6 | Create folder structure following MVVM pattern | Clean architecture |

#### 2. Authentication & Accounts (via Supabase Auth)
| ID | Requirement | Notes |
|----|-------------|-------|
| FR-1.1 | Implement Apple Sign-In using Supabase Auth | Required by App Store |
| FR-1.2 | Implement Email/Password auth via Supabase Auth | Secondary option |
| FR-1.3 | User session must persist across app launches using Supabase Auth tokens | Auto-refresh |
| FR-1.4 | Implement sign-out with local data cleanup | Clear cached data |
| FR-1.5 | Create AuthenticationService wrapping Supabase Auth | Clean abstraction |

#### 3. Photo Capture Flow (4 Required Photos)
| ID | Requirement | Notes |
|----|-------------|-------|
| FR-2.1 | Create guided photo capture wizard with 4 steps | Step-by-step screens |
| FR-2.2 | Step 1: Capture OUTER SIDE of sneaker | With overlay guidance |
| FR-2.3 | Step 2: Capture INNER SIDE of sneaker | With overlay guidance |
| FR-2.4 | Step 3: Capture SIZE TAG inside shoe | With overlay guidance |
| FR-2.5 | Step 4: Capture BOX LABEL | With overlay guidance |
| FR-2.6 | Show visual guidance overlay for each step | Semi-transparent example |
| FR-2.7 | Display progress indicator "Step X of 4" | Clear progress |
| FR-2.8 | Allow retaking any photo before submission | Review screen |
| FR-2.9 | Support importing photos from gallery | Alternative to camera |
| FR-2.10 | Compress images before upload (max 1MB each) | Performance optimization |

#### 4. Image Upload to Supabase Storage
| ID | Requirement | Notes |
|----|-------------|-------|
| FR-3.1 | Upload captured images to Supabase Storage | User-specific bucket |
| FR-3.2 | Generate signed URLs for uploaded images | For Edge Function access |
| FR-3.3 | Show upload progress to user | UX feedback |
| FR-3.4 | Handle upload failures with retry option | Error recovery |

#### 5. AI Analysis via Supabase Edge Function + OpenAI
| ID | Requirement | Notes |
|----|-------------|-------|
| FR-4.1 | Create Supabase Edge Function "authenticate-sneaker" | Deno runtime |
| FR-4.2 | Edge Function receives image URLs and calls OpenAI GPT-4o Vision API | Cloud AI |
| FR-4.3 | Edge Function stores OpenAI API key securely in secrets | Never in app |
| FR-4.4 | AI must return: verdict, confidence %, key observations | Structured JSON |
| FR-4.5 | AI may request additional photos if initial set insufficient | Flexible approach |
| FR-4.6 | Display loading state during analysis ("Analyzing your sneaker...") | UX feedback |
| FR-4.7 | Analysis must complete in < 60 seconds (target < 30s) | Performance goal |

#### 6. Results Display
| ID | Requirement | Notes |
|----|-------------|-------|
| FR-5.1 | Show verdict: "Likely Authentic" / "Likely Fake" / "Inconclusive" | Clear labels |
| FR-5.2 | Show confidence percentage (0-100%) | Numerical clarity |
| FR-5.3 | Use color coding: green (#22C55E) for authentic, red (#EF4444) for fake, amber (#F59E0B) for inconclusive | Visual feedback |
| FR-5.4 | **ALWAYS display disclaimer**: "This result is AI-assisted and does not guarantee authenticity." | Mandatory, visible |
| FR-5.5 | Show key observations from AI analysis | Detail section |
| FR-5.6 | Allow starting a new check from result screen | Flow continuity |
| FR-5.7 | Save result to Supabase "authentications" table | Persistent history |

#### 7. Subscription & Paywall (StoreKit 2)
| ID | Requirement | Notes |
|----|-------------|-------|
| FR-6.1 | Integrate StoreKit 2 for in-app purchases | Apple IAP |
| FR-6.2 | Offer monthly subscription at $9.99/month (unlimited checks) | Primary tier |
| FR-6.3 | Track free checks in Supabase "free_checks" table | 1 free check allowed |
| FR-6.4 | Show paywall after free check is used | Conversion screen |
| FR-6.5 | Paywall must clearly show pricing and value proposition | Conversion focus |
| FR-6.6 | Verify subscription status before each check | Server-side + StoreKit |
| FR-6.7 | Sync subscription status to Supabase "subscriptions" table | Cross-device sync |
| FR-6.8 | Implement restore purchases functionality | App Store requirement |
| FR-6.9 | Handle subscription expiration gracefully | Show paywall again |

#### 8. Error Handling
| ID | Requirement | Notes |
|----|-------------|-------|
| FR-7.1 | Detect and display "no internet" error | Graceful failure |
| FR-7.2 | Handle API timeout with retry option | User control |
| FR-7.3 | Handle poor image quality with retake prompt | Improve accuracy |
| FR-7.4 | Handle unsupported/unrecognized sneaker model | Inform user |
| FR-7.5 | Handle Supabase connection errors | Backend resilience |
| FR-7.6 | Handle StoreKit purchase errors | Payment recovery |

### Phase 2: Polish (Weeks 5-8)

| ID | Requirement | Notes |
|----|-------------|-------|
| FR-8.1 | History screen showing past checks from Supabase | Query authentications table |
| FR-8.2 | Show date, result thumbnail, verdict for each history item | List view |
| FR-8.3 | Onboarding screens for first-time users (3-4 screens) | Welcome flow |
| FR-8.4 | Push notification when result ready (if app backgrounded) | Optional enhancement |
| FR-8.5 | Settings screen with account info, subscription status, sign out | User management |

### Phase 3: Enhancement (Post-launch)

| ID | Requirement | Notes |
|----|-------------|-------|
| FR-9.1 | Additional subscription tiers (e.g., $4.99 for 5 checks) | Revenue optimization |
| FR-9.2 | Allow user to specify sneaker model before analysis | Improve accuracy |
| FR-9.3 | Share result as image/link | Social proof |

---

## Non-Goals (Out of Scope)

| Explicitly Excluded | Rationale |
|---------------------|-----------|
| Human expert verification | Fully automated AI-only |
| Authenticity certificates or guarantees | Liability concerns |
| Offline mode | Requires cloud AI |
| Android app | iOS-first strategy |
| Non-sneaker items (bags, watches, apparel) | Focus on sneakers |
| Marketplace/trading features | Authentication only |
| Social/community features | Keep it simple |
| **On-device ML model (Core ML)** | Cloud-only for easy updates |
| SwiftData for main storage | Use Supabase PostgreSQL |

---

## Supabase Database Schema

```sql
-- Users are managed by Supabase Auth (auth.users table)

-- Authentication history
CREATE TABLE authentications (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
  created_at TIMESTAMPTZ DEFAULT now() NOT NULL,
  verdict TEXT NOT NULL CHECK (verdict IN ('authentic', 'fake', 'inconclusive')),
  confidence INTEGER NOT NULL CHECK (confidence >= 0 AND confidence <= 100),
  observations JSONB, -- AI observations array
  image_urls TEXT[] NOT NULL, -- Supabase Storage paths
  sneaker_model TEXT -- Detected or user-provided
);

-- Enable RLS
ALTER TABLE authentications ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own authentications" ON authentications
  FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can insert own authentications" ON authentications
  FOR INSERT WITH CHECK (auth.uid() = user_id);

-- Subscription tracking (supplements StoreKit)
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL UNIQUE,
  product_id TEXT NOT NULL,
  status TEXT NOT NULL CHECK (status IN ('active', 'expired', 'cancelled')),
  original_transaction_id TEXT,
  expires_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT now() NOT NULL,
  updated_at TIMESTAMPTZ DEFAULT now() NOT NULL
);

-- Enable RLS
ALTER TABLE subscriptions ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own subscription" ON subscriptions
  FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can update own subscription" ON subscriptions
  FOR UPDATE USING (auth.uid() = user_id);

-- Free check tracking
CREATE TABLE free_checks (
  user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  checks_used INTEGER DEFAULT 0 NOT NULL,
  last_check_at TIMESTAMPTZ
);

-- Enable RLS
ALTER TABLE free_checks ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Users can view own free checks" ON free_checks
  FOR SELECT USING (auth.uid() = user_id);
CREATE POLICY "Users can update own free checks" ON free_checks
  FOR UPDATE USING (auth.uid() = user_id);
```

---

## Supabase Edge Function: authenticate-sneaker

```typescript
// supabase/functions/authenticate-sneaker/index.ts
import "jsr:@supabase/functions-js/edge-runtime.d.ts";
import { createClient } from "jsr:@supabase/supabase-js@2";

const OPENAI_API_KEY = Deno.env.get("OPENAI_API_KEY");

const SYSTEM_PROMPT = `You are an expert sneaker authenticator. Analyze the provided images of a sneaker and determine its authenticity.

Evaluate:
1. Stitching quality and consistency
2. Logo placement and accuracy
3. Material quality indicators
4. Shape and proportions
5. Label/tag accuracy
6. Box label details

Return a JSON response:
{
  "verdict": "authentic" | "fake" | "inconclusive",
  "confidence": 0-100,
  "observations": ["observation1", "observation2", ...],
  "additionalPhotosNeeded": ["angle1", "angle2"] | null
}

Be conservative: if uncertain, return "inconclusive" rather than a wrong verdict.`;

Deno.serve(async (req: Request) => {
  try {
    const { imageUrls } = await req.json();
    
    // Call OpenAI Vision API
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${OPENAI_API_KEY}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        model: "gpt-4o",
        messages: [
          { role: "system", content: SYSTEM_PROMPT },
          {
            role: "user",
            content: [
              { type: "text", text: "Please authenticate this sneaker based on these images:" },
              ...imageUrls.map((url: string) => ({
                type: "image_url",
                image_url: { url }
              }))
            ]
          }
        ],
        max_tokens: 1000,
        response_format: { type: "json_object" }
      })
    });

    const data = await response.json();
    const result = JSON.parse(data.choices[0].message.content);
    
    return new Response(JSON.stringify(result), {
      headers: { "Content-Type": "application/json" }
    });
  } catch (error) {
    return new Response(JSON.stringify({ error: error.message }), {
      status: 500,
      headers: { "Content-Type": "application/json" }
    });
  }
});
```

---

## Design Considerations

### Visual Identity
- **App Name:** Auntentic
- **Theme:** Modern, trustworthy, tech-forward
- **Colors:** 
  - Primary: Deep navy (#1E3A5F) or black
  - Authentic: Green (#22C55E)
  - Fake: Red (#EF4444)
  - Inconclusive: Amber (#F59E0B)
- **Typography:** SF Pro (system) for clarity

### Key Screens

```
1. Splash/Launch
2. Sign In (Apple / Email via Supabase)
3. Home (Start New Check button, subscription status)
4. Photo Capture Wizard (4-step)
   - Step 1: Outer Side
   - Step 2: Inner Side
   - Step 3: Size Tag
   - Step 4: Box Label
   - Review: All 4 photos grid
5. Loading/Analyzing ("Analyzing your sneaker...")
6. Result (verdict, confidence, disclaimer)
7. Paywall (for non-subscribers after free check)
8. History (Phase 2)
9. Settings (Phase 2)
```

### Accessibility
- VoiceOver labels for all interactive elements
- Dynamic Type support
- Color + text for status (not color alone)

---

## Implementation Phases

### Phase 1: MVP (Weeks 1-4) ✅ CURRENT FOCUS

**Week 1: Foundation**
- [ ] Xcode project setup (iOS 17+, SwiftUI)
- [ ] Supabase project creation and configuration
- [ ] Supabase database schema (3 tables with RLS)
- [ ] Supabase Auth integration (Apple Sign-In, Email)
- [ ] Basic app navigation structure (MVVM)
- [ ] Supabase Swift SDK integration

**Week 2: Core Flow**
- [ ] Photo capture wizard (4 steps with guidance overlays)
- [ ] Image compression and upload to Supabase Storage
- [ ] Supabase Edge Function: OpenAI Vision integration
- [ ] Result screen with verdict, confidence, disclaimer

**Week 3: Monetization**
- [ ] StoreKit 2 subscription integration
- [ ] Paywall screen design and implementation
- [ ] Free check tracking (Supabase free_checks table)
- [ ] Subscription verification and sync to Supabase

**Week 4: Polish & Testing**
- [ ] Comprehensive error handling
- [ ] Loading states and animations
- [ ] UI polish and accessibility
- [ ] TestFlight beta release

### Phase 2: Enhance (Weeks 5-8)
- Authentication history screen
- Onboarding tutorial
- Push notifications
- Settings screen
- App Store submission

---

## Success Metrics

### MVP Success Criteria (Week 4)

| Metric | Target |
|--------|--------|
| Core flow works | Photo → Upload → OpenAI → Result |
| Supabase integration | Auth + Storage + DB + Edge Functions |
| Subscription works | Purchase via StoreKit 2, verify, paywall |
| Performance | < 60 seconds total (target < 30s) |
| Crash-free | 99%+ stability |

### 6-Month Success Criteria

| Metric | Target |
|--------|--------|
| Downloads | 10,000+ |
| Subscribers | 500+ (5% conversion) |
| MRR | $5,000+ |
| AI Accuracy | 90%+ on test set |
| App Rating | 4.5+ stars |

---

## Security Considerations

- **OpenAI API Key:** Stored ONLY in Supabase Edge Function secrets (NEVER in iOS app)
- **Supabase Keys:** Use anon key in app, service role key only in Edge Functions
- **Auth Tokens:** Supabase manages JWT tokens with auto-refresh
- **Image Privacy:** User-specific Storage buckets with RLS policies
- **HTTPS:** All communication encrypted via TLS

---

## Dependencies (Swift Package Manager)

```swift
// Package.swift dependencies
dependencies: [
    .package(url: "https://github.com/supabase/supabase-swift.git", from: "2.0.0")
]
```

No other third-party dependencies. Pure SwiftUI + StoreKit 2 + Supabase SDK.

---

**Document Version:** 2.0  
**Created:** December 25, 2025  
**Last Updated:** December 25, 2025  
**Status:** Ready for Development
